<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.5 Surface &amp; Electrodes | RAVE Documentation</title>
  <meta name="description" content="RAVE documentation" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="5.5 Surface &amp; Electrodes | RAVE Documentation" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="RAVE documentation" />
  <meta name="github-repo" content="beauchamplab/rave-documentation" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.5 Surface &amp; Electrodes | RAVE Documentation" />
  
  <meta name="twitter:description" content="RAVE documentation" />
  



<meta name="date" content="2022-08-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="step-4-reference-channels.html"/>
<link rel="next" href="generate-epoch.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>




<link rel="stylesheet" href="rave-style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RAVE Manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> url: your book url like <span>https://bookdown.org/yihui/bookdown</span></a>
<ul>
<li class="chapter" data-level="" data-path="showcases.html"><a href="showcases.html"><i class="fa fa-check"></i>Showcases</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="installation-guide.html"><a href="installation-guide.html"><i class="fa fa-check"></i><b>2</b> Installation Guide</a>
<ul>
<li class="chapter" data-level="2.1" data-path="system-prerequisites.html"><a href="system-prerequisites.html"><i class="fa fa-check"></i><b>2.1</b> System Prerequisites</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="system-prerequisites.html"><a href="system-prerequisites.html#macos"><i class="fa fa-check"></i><b>2.1.1</b> MacOS</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="install-rave.html"><a href="install-rave.html"><i class="fa fa-check"></i><b>2.2</b> Install RAVE</a></li>
<li class="chapter" data-level="2.3" data-path="download-demo-data.html"><a href="download-demo-data.html"><i class="fa fa-check"></i><b>2.3</b> Download demo data</a></li>
<li class="chapter" data-level="2.4" data-path="upgrade-rave.html"><a href="upgrade-rave.html"><i class="fa fa-check"></i><b>2.4</b> Upgrade RAVE</a></li>
<li class="chapter" data-level="2.5" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>2.5</b> Troubleshooting</a></li>
<li class="chapter" data-level="2.6" data-path="install-external-programs-dcm2niix-freesurfer-fsl-afni.html"><a href="install-external-programs-dcm2niix-freesurfer-fsl-afni.html"><i class="fa fa-check"></i><b>2.6</b> Install external programs (<code>dcm2niix</code>, <code>FreeSurfer</code>, <code>FSL</code>, <code>AFNI</code>)</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="get-started.html"><a href="get-started.html"><i class="fa fa-check"></i><b>3</b> Get Started</a>
<ul>
<li class="chapter" data-level="3.1" data-path="overview-of-rave-structure.html"><a href="overview-of-rave-structure.html"><i class="fa fa-check"></i><b>3.1</b> Overview of RAVE Structure</a></li>
<li class="chapter" data-level="3.2" data-path="starting-and-closing-rave.html"><a href="starting-and-closing-rave.html"><i class="fa fa-check"></i><b>3.2</b> Starting and Closing RAVE</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="get-data-into-rave.html"><a href="get-data-into-rave.html"><i class="fa fa-check"></i><b>4</b> Get Data into RAVE</a>
<ul>
<li class="chapter" data-level="4.1" data-path="file-hierarchy-and-specification.html"><a href="file-hierarchy-and-specification.html"><i class="fa fa-check"></i><b>4.1</b> File hierarchy and specification</a></li>
<li class="chapter" data-level="4.2" data-path="overview-voltage-data.html"><a href="overview-voltage-data.html"><i class="fa fa-check"></i><b>4.2</b> Overview: Voltage data</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="overview-voltage-data.html"><a href="overview-voltage-data.html#format-1"><i class="fa fa-check"></i><b>4.2.1</b> Format 1</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="importing-demo-data.html"><a href="importing-demo-data.html"><i class="fa fa-check"></i><b>4.3</b> Importing demo data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="importing-demo-data.html"><a href="importing-demo-data.html#step-1-select-subject"><i class="fa fa-check"></i><b>4.3.1</b> Step 1: Select Subject</a></li>
<li class="chapter" data-level="4.3.2" data-path="importing-demo-data.html"><a href="importing-demo-data.html#step-2-select-project-or-create-new-one"><i class="fa fa-check"></i><b>4.3.2</b> Step 2: Select Project or Create New One</a></li>
<li class="chapter" data-level="4.3.3" data-path="importing-demo-data.html"><a href="importing-demo-data.html#step-3-validate-data"><i class="fa fa-check"></i><b>4.3.3</b> Step 3: Validate Data</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="importing-your-own-data.html"><a href="importing-your-own-data.html"><i class="fa fa-check"></i><b>4.4</b> Importing Your Own Data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="importing-your-own-data.html"><a href="importing-your-own-data.html#organizing-your-directories"><i class="fa fa-check"></i><b>4.4.1</b> Organizing Your Directories</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="preprocessing.html"><a href="preprocessing.html"><i class="fa fa-check"></i><b>5</b> Preprocessing</a>
<ul>
<li class="chapter" data-level="5.1" data-path="step-1-import-signals.html"><a href="step-1-import-signals.html"><i class="fa fa-check"></i><b>5.1</b> Step #1: Import Signals</a></li>
<li class="chapter" data-level="5.2" data-path="step-2-notch-filter.html"><a href="step-2-notch-filter.html"><i class="fa fa-check"></i><b>5.2</b> Step #2: Notch Filter</a></li>
<li class="chapter" data-level="5.3" data-path="step-3-wavelet.html"><a href="step-3-wavelet.html"><i class="fa fa-check"></i><b>5.3</b> Step #3: Wavelet</a></li>
<li class="chapter" data-level="5.4" data-path="step-4-reference-channels.html"><a href="step-4-reference-channels.html"><i class="fa fa-check"></i><b>5.4</b> Step #4: Reference Channels</a></li>
<li class="chapter" data-level="5.5" data-path="surface-electrodes.html"><a href="surface-electrodes.html"><i class="fa fa-check"></i><b>5.5</b> Surface &amp; Electrodes</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="surface-electrodes.html"><a href="surface-electrodes.html#reconstruction-coregistration"><i class="fa fa-check"></i><b>5.5.1</b> Reconstruction &amp; Coregistration</a></li>
<li class="chapter" data-level="5.5.2" data-path="surface-electrodes.html"><a href="surface-electrodes.html#electrode-localization"><i class="fa fa-check"></i><b>5.5.2</b> Electrode Localization</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="generate-epoch.html"><a href="generate-epoch.html"><i class="fa fa-check"></i><b>5.6</b> Generate Epoch</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="qas.html"><a href="qas.html"><i class="fa fa-check"></i><b>6</b> Q&amp;As</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rave-installation.html"><a href="rave-installation.html"><i class="fa fa-check"></i><b>6.1</b> RAVE Installation</a></li>
<li class="chapter" data-level="6.2" data-path="external-program-installation-dcm2niix-freesurfer-fslafni.html"><a href="external-program-installation-dcm2niix-freesurfer-fslafni.html"><i class="fa fa-check"></i><b>6.2</b> External Program Installation (dcm2niix, FreeSurfer, FSL/AFNI)</a></li>
<li class="chapter" data-level="6.3" data-path="getting-started-with-rave.html"><a href="getting-started-with-rave.html"><i class="fa fa-check"></i><b>6.3</b> Getting Started with RAVE</a></li>
<li class="chapter" data-level="6.4" data-path="downloading-demo-data.html"><a href="downloading-demo-data.html"><i class="fa fa-check"></i><b>6.4</b> Downloading Demo Data</a></li>
<li class="chapter" data-level="6.5" data-path="importing-data.html"><a href="importing-data.html"><i class="fa fa-check"></i><b>6.5</b> Importing Data</a></li>
<li class="chapter" data-level="6.6" data-path="notch-filter.html"><a href="notch-filter.html"><i class="fa fa-check"></i><b>6.6</b> Notch Filter</a></li>
<li class="chapter" data-level="6.7" data-path="wavelet.html"><a href="wavelet.html"><i class="fa fa-check"></i><b>6.7</b> Wavelet</a></li>
<li class="chapter" data-level="6.8" data-path="reconstruction-coregistration-1.html"><a href="reconstruction-coregistration-1.html"><i class="fa fa-check"></i><b>6.8</b> Reconstruction &amp; Coregistration</a></li>
<li class="chapter" data-level="6.9" data-path="electrode-localization-1.html"><a href="electrode-localization-1.html"><i class="fa fa-check"></i><b>6.9</b> Electrode Localization</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">RAVE Documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="surface-electrodes" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Surface &amp; Electrodes<a href="surface-electrodes.html#surface-electrodes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The surface &amp; electrodes section is composed of two modules: Reconstruction &amp; Coregistration and Electrode Localization.</p>
<!-- add sentence summarizing overall purpose/goal of surface & electrodes section -->
<div id="reconstruction-coregistration" class="section level3 hasAnchor" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Reconstruction &amp; Coregistration<a href="surface-electrodes.html#reconstruction-coregistration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Reconstruction &amp; Coregistration module has three main goals: import raw magnetic resonance (MR) and computerized tomography (CT) images into RAVE, reconstruct a model of the subject’s cortical surface, and align the imported MRI &amp; CT images. These tasks are important to ensure proper running of the Electrode Localization module.</p>
<p>There are two panels to note: Data settings and Command-line settings. Refer to the following screenshot for guidance.</p>
<div class="figure">
<img src="static/image/Reconstruction&amp;Coregistration.png" alt="" />
<p class="caption">Sample Reconstruction &amp; Coregistration Window</p>
</div>
<p><strong>Data Settings</strong>:</p>
<p>Start by using the <u> project and subject drop down menus </u> to select the subject whose MRI and CT images that will be imported. Once again, using the blue “sync project &amp; subject from [Import LFP] module” link at the bottom of the panel will automatically select the project and subject that was just being worked on.</p>
<p>Next, use the <u> MRI drop down menu </u> to select the <strong>raw MRI image</strong> for the selected subject. RAVE currently accepts two input types for MRI images:</p>
<ul>
<li><strong>DICOM:</strong> submit a folder of DICOM files, representing a series of 2D brain slices</li>
<li><strong>Nifti:</strong> submit a single Nifti file representing the full 3D brain scan (e.g. subject_MRI.nii)</li>
</ul>
<!-- outdated: Note: Select the checkbox "Skip the FreeSurfer Reconstruction" if reconstructing the subject's cortical surface model is not necessary. By default, this box will be checked.-->
<p>Then, use the <u> Raw CT DICOM folder </u> drop down menu to select the <strong>raw CT image</strong> for the selected subject. Your input should be a <strong>DICOM folder</strong>.</p>
<!-- double check ... can it also be a nifti file? what about with the YCQ subject I have that has a folder with .nii files? -->
<!-- outdated: Note: Select the checkbox "Skip the CT Co-Registration" if it is not desired to align and overlay the subject's CT scan with their MRI image. By default, this will be unchecked because aligning/overlaying this data allows for the accurate localization of electrodes. -->
<p>For more information on these file formats, visit the Q&amp;A at <a href="#Reconstruction&amp;Coregistration">Reconstruction &amp; Coregistration</a>.
<!-- maybe add a question on the file formats, but also more info about what co-registration iss --></p>
<p>Then, proceed to the command-line settings panel.</p>
<!-- if you select a nii file, then it doesn't need to be converted to nifti format, so does RAVE just skip the dcm2niix command? -->
<p><strong>Command-line settings</strong>:</p>
<p>The following steps will involve the computer’s <u> command-line interface. </u> (On Mac, this refers to the Terminal. On Windows, it refers to Command Prompt.) RAVE requires the use of the external programs <code>dcm2niix</code> and <code>FreeSurfer</code>, and then either <code>FSL</code> or <code>AFNI.</code> This panel simply confirms whether the programs were downloaded by displaying the location of the program on the computer. If the file path is <strong>not</strong> automatically filled in for <code>dcm2niix</code>, <code>FreeSurfer</code>, and your choice of <code>FSL</code> or <code>AFNI</code>, please return to the installation guide at <a href="install-external-programs-dcm2niix-freesurfer-fsl-afni.html#install-external-programs-dcm2niix-freesurfer-fsl-afni">Install External Programs</a> and follow the steps to download the missing software. Descriptions of what these programs do are also available in the installation guide.</p>
<p>Now, click the blue <strong>Check data and command-line tools</strong> button. A pop-up will appear confirming the MRI/CT inputs and what tasks will be completed using the external programs. Please also pay attention to any warnings that will be listed (e.g. if RAVE can not find FSL-flirt, if there is an existing <code>FreeSurfer</code> reconstruction for a subject). In particular, warnings that say “the script will fail/error” should <strong>not</strong> be ignored, as that indicates some tasks will can not be completed. (For help resolving common warnings, visit the Q&amp;A at <a href="reconstruction-coregistration-1.html#reconstruction-coregistration-1">Reconstruction &amp; Coregistration</a>.) When ready, hit “proceed”.</p>
<p>The following screen will appear, with four panels: Subject Information, Import DICOM Images, Surface Reconstruction, and Co-Registration CT to T1. Refer to the following screenshot for guidance.</p>
<div class="figure">
<img src="static/image/Reconstruction&amp;Coregistration2.png" alt="" />
<p class="caption">Sample Reconstruction &amp; Coregistration Screen</p>
</div>
<p><strong>Subject Information:</strong> The project and subject whose MRI and CT data is currently being used will be displayed here. A task list will also be displayed. By default, three tasks will be listed: 1). Convert <code>.dcm</code> images to <code>.nii</code>, 2). Surface reconstruction, and 3). CT co-registration.</p>
<p><strong>Import DICOM Images:</strong> Begin here to convert MRI and CT DICOM images to the <code>Nifti</code> format using the <code>dcm2niix</code> external library. The <code>Nifti</code> format will be used by <code>FreeSurfer</code> and <code>FSL</code>/<code>AFNI</code> in later steps. Press on the “+” sign in the right corner of the panel to expand the view.</p>
<blockquote>
<p>Note: This script requires the Unix <code>bash</code> terminal in order to run commands read from the command-line interface. If using a Mac, this should already be provided. If using Windows, please install the Linux sub-system (WSL2).</p>
</blockquote>
<p>Specify the following configurations using the drop-down menu:</p>
<ul>
<li><p><strong>Merge 2D slices from same series regardless of echo, exposure, etc:</strong> Select “yes” to force stacking of the slices. Select “no” to separate images according to their echo (MRI), study times, exposure level (CT), orientation, etc for reasons such as preserving contrast. Select “auto” for <code>dcm2niix</code> to automatically decide whether to merge based on the image modality (i.e. MRI vs CT). Note that merging will consolidate slices from the series into one <code>Nifti</code> file, whereas merging can generate multiple <code>Nifti</code> files.</p></li>
<li><p><strong>Crop 3D acquisitions:</strong> Select “yes” to remove excess air as well as neck tissue from the 3D acquisitions. Select “no” if this is not necessary. Select “ignore” for images to be neither cropped nor rotated to the nearest orthogonal direction to canonical space (e.g. for non-anatomical scans).</p></li>
</ul>
<p>Based on these configurations, a series of commands will be automatically generated in the greyspace below. Click the sideways black triangles at the bottom left of the panel to view these commands. Note that there are separate series of commands for the MRI and CT images.</p>
<blockquote>
<p>Note: The grey text represents comments. The purple texts are the actual commands that will be run by the computer.</p>
</blockquote>
<p>RAVE provides the choice of copying these commands and running them on the computer’s command-line interface manually. This is recommended as other RAVE features can still be used while the commands run in the background, which is especially helpful if the commands will take a long time. Select the blue “save &amp; run by yourself” button; a pop-up will appear and pressing the greyspace will automatically copy the commands.</p>
<p>Alternatively, RAVE can run the commands directly. Simply select the grey “Run from RAVE (T1 MRI)”. A pop-up will appear indicating when <code>dcm2niix</code> has finished converting the MRI images from the DICOM to Nifti format (note that if the MRI file was already in the Nifti format, RAVE will simply make a copy of that file). Then, select the “Run from RAVE (CT)” button to repeat this process with the CT image. These processes usually take a few seconds.</p>
<p><strong>The resulting Nifti MRI and CT files will be stored in an <code>inputs</code> folder within the subject’s <code>rave-imaging</code> folder.</strong></p>
<p><strong>Surface Reconstruction:</strong></p>
<p>This panel reconstructs a subject’s cortical surface using <code>FreeSurfer</code> and the <code>Nifti</code> MRI file.<br />
&gt;Note: This script requires the Unix <code>bash</code> terminal in order to run commands read from the command-line interface. If using a Mac, this should already be provided. If using Windows, please install the Linux sub-system (WSL2)</p>
<p>Start by selecting the <code>Nifti</code> <strong>MRI File</strong> desired. (The blue “refresh” link can be pressed to update the drop-down if changes have recently been made to the subject’s folder.) Next, select the <strong>recon flag</strong>, which refers to which <code>FreeSurfer</code> steps are desired for the reconstruction of the brain model. Visit the <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/recon-all">FreeSurfer website</a> to learn more about the seven choices. Use the drop-down menu on RAVE to select the recon flag that is fitting for the project. A screenshot has been included below for convenience indicating the steps each flag includes:</p>
<p><img src="static/image/FreeSurferFlags.png" alt="FreeSurfer Flags" />
&gt; Note: Most flags can take several hours for the computer to run. If the quickest flag is desired, select <strong>-autorecon1</strong> in the drop-down menu; it includes minimal steps and so only takes 10 minutes to run.</p>
<p>Proceed to the “Remove existing work before running the command (if applicable)” checkbox. Selecting the box is appropriate if the subject’s cortical surface was already partially or fully reconstructed and it is desired to start anew (e.g. if an error resulted due to a licensing issue). By default, this will be unchecked.</p>
<!-- label for terminal script doesn't update based on flag for some reason -->
<p>Commands will be generated in the greyspace below. Click on the black triangle at the bottom of the panel to view the commands. Once again, to run them manually, click the blue “Save &amp; run by yourself” button. To have RAVE invoke system command, select the “Run from RAVE” button.</p>
<p>A pop-up will appear indicating when the process is completed; at that point, <strong>outputs will have been stored in a newly created <code>fs</code> folder in the subject’s rave-imaging folder.</strong></p>
<!-- what does "scripts" file in rave imaging store? does it automatically store the command-line scripts used -->
<!-- specify outputs of each; what are outputs -->
<p><strong>Co-Registration CT to T1:</strong></p>
<p>This panel will align and overlay (aka “co-register”) the subject’s MRI &amp; CT images using either <code>FSL</code> or <code>AFNI.</code></p>
<blockquote>
<p>Note: This script requires the Unix <code>bash</code> terminal in order to run commands read from the command-line interface. If using a Mac, this should already be provided. If using Windows, please install the Linux sub-system.</p>
</blockquote>
<p>Use the drop down menu to select the <strong>CT file</strong>. (The blue “refresh” link can be pressed to update the drop-down if changes have recently been made to the subject’s folder.) Then use the <strong>program</strong> drop down to specify whether <code>FSL</code> or <code>AFNI</code> will be used.</p>
<p>Click the black triangle on the bottom of the panel to display the commands. Once again, select the appropriate button based on whether the commands will be run manually or through RAVE. Note that this process takes around 30 minutes; a pop-up will indicate when it is finished. <strong>The output will be a single <code>ct_in_t1.nii.gz</code> file representing the CT scan co-registered with the MRI image. The file is stored in the <code>coregistration</code> folder within the subject’s <code>rave-imaging</code> folder.</strong></p>
<p>Now, proceed to the electrode localization module to begin identifying electrodes!</p>
</div>
<div id="electrode-localization" class="section level3 hasAnchor" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Electrode Localization<a href="surface-electrodes.html#electrode-localization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>RAVE’s electrode localization module features a built-in 3D viewer and allows for the quick and precise identification of where in the brain electrodes are located. The module is based on the co-registered image of the CT and MRI scans, as well as the reconstruction of the subject’s cortical surface via the MRI scan.</p>
<!-- add: Users are able to _______, label electrodes, and form groups. like expand on features -- able to view on screen -->
<p>When the electrode localization module is selected, two panels will appear on the screen: Data Selection &amp; Electrode Plan. Refer to the following screenshot for guidance.</p>
<!-- describe what electrode localization even is -->
<p><img src="static/image/electrodelocalization1.png" alt="Electrode Localization Screen" />
<strong>Data Selection:</strong></p>
<p>Begin in the data selection panel at left. Use the <strong>project and subject drop down menus</strong> to select the subject whose electrodes you wish to localize. You can once again use the “Sync from [Import LFP] module” to automatically select the project and subject that was just imported.</p>
<p>Next, use the drop down menu in <strong>choose CT aligned to T1</strong> to select the <code>Nifti</code> file representing the co-registered CT and MRI scans (e.g. <code>ct_in_t1.nii</code> that was generated in the previous module). It is alternatively possible to directly upload a co-registered <code>Nifti</code> file by selecting the “upload” option and resulting “browse” button. Note that if changes have been made to the file directory, selecting the blue “refresh file list” link will update the drop down menu.</p>
<p>If it is preferred <u> not </u> to localize with the CT image (such as in cases where a CT scan is not yet available), select the checkbox “Do not localize with CT.” The subject’s MRI image will be used in lieu. By default, this will be unchecked as using a co-registered CT and MRI image allows for more precise localization of electrodes.</p>
<p>Proceed to the Electrode Plan panel.</p>
<p><strong>Electrode Plan:</strong></p>
<p>This panel allows for the creation of <strong>groups</strong> to provide a more organized way to localize a subject’s electrodes.</p>
<p>As many or as few groups can be created as desired. Scroll to the bottom of the panel to use the <strong>plus button</strong> to add a new group, or the <strong>minus button</strong> to delete the bottom-most group.</p>
<p>For each group, specify the:</p>
<ul>
<li><p><strong>Label:</strong> the desired name for the group.</p></li>
<li><p><strong>Dimension:</strong> the number of electrodes within the group.</p></li>
</ul>
<blockquote>
<p>Note: For electrode groups placed in a grid, it is recommended to input the dimensions in the format “number x number,” e.g. “8x4”, rather than specifying a whole number total, e.g. 32. Using this format can help automatically set the 3D viewer’s configurations for easier localization of electrodes.</p>
</blockquote>
<ul>
<li><strong>Type:</strong> the type of exam the electrodes came from. Select from electroencephalogram (EEG), intracranial EEG (iEEG), stereotactic EEG (sEEG), ElectroCochleoGraphy (ECoG), or “other”.</li>
</ul>
<p>Note that for each group, a summary will be displayed to indicate the individual electrode labels (e.g. G1 - G32), as well as total number of electrodes.</p>
<p>When the groups are ready, click the blue <strong>Load Subject</strong> button to proceed. If there are any errors, a pop-up will appear indicating the error and a recommended fix (e.g. “invalid CT file. Please specify or upload your own.”) If there are no errors, a “loading in progress” pop-up will appear indicating that the coregistered file and 3D viewer are being loaded. This process can take a few minutes.</p>
<p>Once finished, the 3D viewer screen will automatically appear, with two panels: Localization Plan Details and Interactive 3D Viewer. Refer to the following screenshot for guidance:</p>
<p><img src="static/image/electrodelocalization2.png" alt="Electrode Localization 3D Viewer Screen" />
Notice that the right panel contains the <strong>3D Viewer,</strong> which consists of the subject’s reconstructed brain model shown in black/white and their electrodes shown in green. Use the computer’s mousepad to zoom in and out of the model.</p>
<p>Begin in the <strong>Localization Plan Details</strong> panel on the left, which displays the groups created on the previous screen. Begin by selecting a group to localize its electrodes. A table will appear with a row for each electrode in the group and columns specifying each electrode’s label, tkrRAS location, MNI152, and FSLabel.</p>
<p>tkrRAS is a surface coordinate system used by FreeSurfer, where R orients toward the right direction, A orients toward the anterior direction, and S orients toward the superior direction. By default, these values will be set to 0,0,0. MNI152 is a volumetric coordinate system derived from averaging 152 individuals’ MRI scans. By default, these values will be empty. (To learn more about these coordinate systems, visit the Q&amp;A at <a href="electrode-localization-1.html#electrode-localization-1">Electrode Localization</a>.) FSLabel represents the anatomical location of the electrode. By default, these values will be empty.</p>
<p>Now, click on the <strong>Show/Hide Localization Instructions</strong> button at the bottom of the panel to <strong>receive specific instructions on how to use the 3D viewer to localize the selected group’s electrodes.</strong> Generally speaking, steps will consist of:</p>
<ol style="list-style-type: decimal">
<li><p>In the Electrode Localization settings on the 3D viewer, change <code>Edit Mode</code> from disabled to <code>CT/Volume</code> if the subject’s CT scan is available, or <code>MRI slice</code> if no CT is available.</p></li>
<li><p><strong>Double click</strong> on the green spot that represents the first electrode of the group. This will mark the spot with a yellow circle labeled “1,” as well as automatically update the tkrRAS and MNI152 coordinate locations of this electrode in the table. Repeat this step for the last electrode of the group.</p></li>
<li><p>In the Electrode Localization settings on the 3D viewer, change <code>Interpolate Size</code> to the total number of electrodes - 2.</p></li>
<li><p>In the Electrode Localization settings on the 3D viewer, click <code>Interpolate from Recently Added</code> for RAVE to automatically localize the remaining electrodes in the group. Notice that these electrodes will be labeled on the 3D viewer with yellow circles and coordinate locations will automatically be filled in on the table.</p></li>
</ol>
<p>(To <strong>refine the electrode locations,</strong> set <code>Edit Mode</code> to “refine” and then press the <code>Auto-Adjust All</code> button. Alternatively, manually select a single electrode. It will turn red and the keyboard keys <code>1</code>, <code>2</code>, and <code>3</code> can then be used to move the electrode around.)</p>
<p>Double-click on a row in the table to open a drop-down menu to set the <strong>FreeSurfer label</strong> of each electrode. RAVE can automatically select the anatomical region of the brain that the electrode is located in, or it can be selected manually.</p>
<p>Note: each electrode’s MNI152 coordinates are hyperlinked to Neurosynth, a platform for fMRI data. The link contains data on past maps, studies, and associations that have been associated with the electrode’s coordinates.</p>
<p>Repeat the localization steps for each group. When finished, to see all of the subject’s electrodes in one table, click the <strong>Stage &amp; Show Electrode Table</strong> button in the bottom left corner of the screen. Click <strong>Save to Subject</strong> button to save this data for use in later RAVE sessions.</p>
<p>It may be helpful to <strong>adjust 3D viewer settings</strong> to more easily localize electrodes. There are various settings for the viewer that can be changed using the black box on the right side of the panel:</p>
<p><strong>Default Settings:</strong></p>
<ul>
<li><p><u> Background color: </u> change the background color of the viewer.</p></li>
<li><p><u> Record (chrome-on): </u> clicking here will start recording the 3D viewer and clicking again will stop the recording. A video in the .webm format will automatically download to the computer. This feature can be used to generate a video of the localization process.</p></li>
<li><p><u> Screenshot: </u> click here to take a screenshot of the current image in the 3D viewer. A .pdf file containing the image will automatically download to the computer.</p></li>
<li><p><u> Reset: </u> reset the brain model to its default position.</p></li>
<li><p><u> Camera position: </u> use the drop-down to change the view of the brain from the default <code>free rotate</code> (change orientation freely by dragging the cursor) to <code>[lock]</code> (preserve current orientation), <code>right</code>, <code>left</code>, <code>anterior</code>, <code>posterior</code>, <code>superior</code>, or <code>inferior</code>.</p></li>
<li><p><u> Display coordinates: </u> enabling this checkbox will display the tkRAS coordinate plane in the bottom left corner of the viewer.</p></li>
</ul>
<p><strong>Volume Settings:</strong></p>
<p>These settings control aspects of the view of the 3D model and the CT overlay.</p>
<!-- add beginning sentence -->
<ul>
<li><p><u> Show Panels: </u> Enable this checkbox to simultaneously display the coronal, axial, and sagittal views of the brain. For each viewer, click anywhere on the brain to automatically adjust the other viewers to visualize that position. Clicking the <code>P</code> button will lock the viewer so that clicking on the brain will not readjust the other viewers’ positions. Note also that the <code>+</code> and <code>-</code> buttons can be used to zoom in and out of each viewer and the <code>0</code> button will reset the zoom back to default. Note that dragging the grey bar at the top of each view box can move the box elsewhere on the panel, and dragging the grey triangle at the bottom right corner will expand the box size.</p></li>
<li><p><u> Reset Position: </u> If the Show Panels checkbox is enabled, clicking this button will reset all three plane viewers (coronal, axial, and sagittal) to their default positions.</p></li>
<li><p>Use <u> Coronal, Axial, and Sagittal </u> sliders to quickly adjust the positions of the planes on the main and individual viewers. Moving the coronal slider from left to right will move that plane from the posterior to anterior end of the brain, respectively. Moving the axial slider from left to right will move that plane from the inferior to superior end of the brain, respectively. Moving the sagittal slider will move that plane from the left to right end of the brain, respectively. For each slider, a coordinte can also be entered manually to set the plane position. By default, each slider is set to 0. Note that keyboard shortcuts are shown in grey next to each slider.</p></li>
<li><p><u> Intersect MNI305: </u> displays the coordinates in the MNI305 space where the coronal, axial, and sagittal planes intersect.</p></li>
<li><p>Use the <u> overlay coronal, axial, and sagittal checkboxes </u> to control whether each plane is visible on the main 3D viewer. By default, these are checked to show all three planes.</p></li>
<li><p><u> Dist. threshold: </u></p></li>
</ul>
<!-- couldn't figure out what this does, didn't notice any changes on the 3D viewer when I played with it -->
<ul>
<li>Use the <u> Voxel Type: </u> drop down menu to select which scan to overlay on the brain model in the 3D viewer. By default, this is set to <code>CT</code> indicating that the subject’s CT is overlaid in green.</li>
</ul>
<!-- control which scan to overlay on the brain model in the 3D viewer. By default, this is set to **CT scan** and the details of the CT are displayed on the viewer in green. whether or not the subject's CT scan is visible on the 3D viewer. By default, this is set to `CT` indicating that the CT is overlaid in **green** on the subject's brain model.  
 -->
<!-- what does this do / why isn't MRI an option / isn't "voxel" a bit general/vague -->
<ul>
<li><p>Use the <u> Voxel Display: </u> drop down menu to control whether or not the selected voxel type (i.e. CT) is visible or hidden on the 3D viewer. By default, it will be set to visible (<code>normal</code>).</p></li>
<li><p>Use the <u> Voxel Opacity: </u> slider to control the opacity of the voxel type selected, from 0 (transparent) to 1 (opaque). Note that a value can also be entered manually. By default, this is set to 1.</p></li>
</ul>
<!-- add what is purpose of opacity slider; wouldn't you want it to be opaque -->
<ul>
<li>Use the <u> Voxel Min </u> and <u> Voxel Max </u> sliders to adjust the threshold range for how much of the CT scan is visible on the 3D viewer. <strong>Setting this range is important to ensure clear viewing of the electrodes for easy localization.</strong> For example, reducing the minimum will display the skull on the 3D viewer. By default, the minimum is set to <code>3000</code> and the maximum is set to <code>3071</code> as these values provide a clear view of the electrodes with minimum interference from the rest of the CT image.</li>
</ul>
<p><strong>Surface Settings:</strong></p>
<p>These settings control aspects of the 3D model of the subject’s cortical surface.</p>
<ul>
<li>Use the <u> Subject: </u> drop-down menu to easily switch between which subject’s 3D brain model is displayed in the 3D viewer.</li>
</ul>
<!-- confused about this ... didn't we have to select subject on previous screen, so why do we have to select it again here? -->
<ul>
<li><p>Surface Type:</p></li>
<li><p>Use the <u> Surface Material: </u> drop down menu to select a material to visualize the subject’s cortical surface. The materials, <code>MeshPhong</code> (default) and <code>MeshLambert</code>, differ in how they display lighting of the 3D brain model. (See the Q&amp;A at <a href="surface-electrodes.html#electrode-localization">Electrode Localization</a> for more information on this difference.)</p></li>
</ul>
<!-- add more detail to differences? -->
<ul>
<li><p>Use the <u> Left Hemisphere: </u> and <u> Right Hemisphere: </u> drop-down menus to set the visualization of each hemisphere as <code>normal</code> (complete, solid representation of cortical surface), <code>wireframe</code> (simplified, skeletal representation of cortical surface using lines), or <code>hidden</code> (hemisphere not displayed). By default, each hemisphere is set to <code>normal.</code></p></li>
<li><p>Use the <u> Left Opacity: </u> and <u> Right Opacity: </u> sliders to control the opacity of each hemisphere, from 0 (hemisphere not displayed) to 1 (hemisphere fully-rendered). Note that a value can also be entered manually. By default, each slider is set to 1.</p></li>
<li><p>Use the <u> Surface Color: </u> drop-down menu to control how the color of the 3D brain model is rendered. By default, this is set to <code>vertices</code>, but other options include <code>sync from voxels</code> (note that selecting this will open two sliders for the <code>blend factor</code> and <code>sigma</code>, set to 0.4 and 3 by default), <code>sync from electrodes</code> (note that in addition to blend factor and sigma, a <code>decay</code> slider will also be displayed, set to 0.15 by default), or <code>none</code> (no color rendering on model). (See the Q&amp;A at <a href="electrode-localization-1.html#electrode-localization-1">Electrode Localization</a> for more information on the differences between these color-rendering methods.)</p></li>
</ul>
<!-- add more detail to surface color to explain how the different methods are used, or go to Q&A. ask about differences in this -->
<p><strong>Electrodes:</strong></p>
<ul>
<li><p><u> Map Electrodes: </u></p></li>
<li><p><u> Visibility: </u></p></li>
</ul>
<p><strong>Electrode Localization:</strong></p>
<p><strong>Data Visualization:</strong></p>
<!-- how/why do people usually group the electrodes? e.g. by location? by type? because it makes it easier for analysis? -->
<!-- can someone have no groups -->
<!-- instead of other, can they type in what they want? look into difference between types -->
<!-- specify that selecting "load subject" can switch to fix the groups -->
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="step-4-reference-channels.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="generate-epoch.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/linasc3-ai/rave-documentation/edit/main/05-preprocessing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
