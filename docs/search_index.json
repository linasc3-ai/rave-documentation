[["preprocessing.html", "Chapter 5 Preprocessing", " Chapter 5 Preprocessing The following steps will walk through the preprocessing of the raw iEEG signal data so that it can optimally be used in future analysis modules. The corresponding modules are: (These must be done first, in order:) Notch Filter Wavelet Referencing (These can be done after, in any order:) Surface Registration Localization Generate Epoch "],["step-1-import-signals.html", "5.1 Step #1: Import Signals", " 5.1 Step #1: Import Signals This step involves importing iEEG data into RAVE so that it can be preprocessed and used in future modules. Step 1.1: Select project &amp; subject First, use the drop down menu to specify which project the cleaned subject data will be stored in. To create a new project, select “New Project” from the drop down menu and indicate the desired project name. Note that by default, this project folder will be created within the rave_data folder of the data directory (data_dir), in a new folder for the subject. Next, use the drop down menu to select the code for the subject whose data to import. Note that a subject’s data should be stored in its own folder within the raw directory (raw_dir folder) within therave_data folder. Click the “Create Subject” button to proceed to the next step. Step 1.2: Format &amp; session blocks RAVE defines a block/session as a period of continuous electrode recording. Here, first select the blocks that correspond to the trials to analyze. Note that when a block is selected, a preview of the files it contains will pop-up to the right. This feature helps check that the way the data is stored is consistent with the file type selected. Then, specify the file format the iEEG data is stored in. RAVE currently supports four file formats: .mat/.h5 file per electrode per block single .mat/.h5 file per block single EDF(+) file per block single BrainVision file Note that when a format from the drop down is selected, a brief description of that specific format will pop-up underneath the menu. For more information on these file types, visit the Q&amp;A at Importing Data Step 1.3: Channel information RAVE equates a channel to an electrode. Set the following specifications for the channels: Data file: Channel numbers: Indicate the electrodes to analyze. It is recommended that the preprocessing steps are run on all electrodes at once. Note that RAVE can automatically detect potential electrodes based on the specified blocks and file type; this suggestion is displayed at the bottom of the panel. Physical unit: Indicate the units used to measure voltage. Sample rate: Indicate the rate of the iEEG recording equipment; this value will determine the rate at which the preprocessing will be run. Now, select the Validate &amp; Import button to validate your data. A pop-up will soon appear asking about readiness to import your data. Please double check all the information entered is correct, and then select the Import Data button to proceed. A progress bar will appear in the bottom left corner. A pop-up will soon appear indicating that the subject data was successfully imported into RAVE! Now, use the menu on the left side of the screen to select the first preprocessing module, notch filter. "],["step-2-notch-filter.html", "5.2 Step #2: Notch Filter", " 5.2 Step #2: Notch Filter What is a notch filter? A notch filter blocks a given frequency or a narrow range of frequencies (aka a “bandwidth”) from a signal without affecting the rest of that signal. It is often used to minimize line noise interference in raw iEEG data, which helps ensure that future analyses only consider actual brain data. A common source of this interference is the amplifier used in recording set-ups to convert electrode signals into a form readable by the computer. This interference is commonly introduced at 60 Hz, since that is the standard frequency used in the North American electrical grid system. To apply the notch filter, RAVE performs a fast fourier transform (FFT) of the signal. To learn more about FFT, visit the Q&amp;A section at Notch Filter. To apply the notch filter to your data, follow the steps below. Begin in the Data Selection window to specify which data to perform the notch filter on . Use the drop down to indicate the desired project and subject. Note that pressing the Sync from [Import LFP] module link will automatically select the project and subject that was just imported in the Import Signals module. Proceed by selecting the Load Subject button. A new screen will load with three panels: Filter Settings, Inspection, and Notch. Refer to the following screenshot for guidance. Sample Notch Filter Screen Filter Settings: Begin my indicating the desired configurations for the filter(s). Base frequency refers to the frequency introduced by the amplifier that should be removed. By default, this is set as 60 Hz as that is the frequency introduced by most iEEG amplifiers. x Times sets the multipliers of the base frequency to remove by the filter. This feature accounts for harmonics (waves with frequencies that are positive integer multiples of the base frequency), which result because the signal from the amplifier is not a pure sine wave when undergoing FFT analysis. By default, this value is set as “1,2,3” based on the harmonics that commonly result in iEEG recording set-ups. This default means that 60 Hz (base frequency * 1), 120 Hz (base frequency * 2), 180 Hz (base frequency * 3) are the frequencies that the notch filter will remove. +- Bandwidth (Hz) refers to how wide to make each filter; a higher number will remove a wider range of frequencies whereas a lower number will remove a narrower range of frequencies. Enter one number for each filter. By default, this value is set to 1,2,2 – in other words, the filters will remove the bandwidths 59 - 61 Hz (aka 60 Hz +/- 1), 118 - 122 Hz (aka 120 Hz +/- 2), 178 - 182 Hz (aka 180 Hz +/- 2) respectively. Based on these configurations, the bottom of the panel will automatically display a summary of how many filters there are and the bandwidths each will remove. Click the blue Apply Notch Filters button to apply the filters to the data. A pop-up will appear showing a summary of the configurations. Click “Confirm” to proceed. Inspection: Controls settings of the figures displayed in the Notch: Inspect Signals panel located to the right. Use the block and electrode drop down menus to select the data to display in the Notch: Inspect Signals panel. You can use the previous and next buttons to easily switch between which electrode’s data is displayed within a selected recording session. The window length slider controls the power range displayed for the Welch periodograms. The more the slider is moved to the right, the wider the dB range on the y-axis. The frequency limit slider controls the frequency range for the Welch periodograms. The more the slider is moved to the right, the higher the frequencies that will be displayed on the x-axis. The number of histogram bins slider controls how wide the voltage ranges on the horizontal axis of the histogram are, where each bin represents a vertical bar on the graph. Choosing a larger number will create narrower voltage ranges and thus more vertical bars, whereas choosing a smaller number will create wider voltage ranges and thus fewer vertical bars. Moving the slider can give a more precise look at which voltages are most represented in the electrode signal. Notch: Inspect Signals: Displays *raw and filtered iEEG signals for each channel whose data was imported. The top Local Field Potential Graph plots voltage versus time in seconds to show the raw signal that was recorded from the selected electrode. The red lines on the graph reflect the normalization. The leftmost Welch Periodogram estimates the power of the signal at its component frequencies. Before applying the notch filter, only the original graph will be shown in grey. After the notch filter has been applied, the filtered signal will be shown in red; it should visibly be evident thaat the the power of the signal is reduced at the base and harmonic frequencies. To learn more about the calculation of the Welch Periodogram, visit the Q&amp;A at Notch Filter. The center Welch Periodogram is the same as the leftmost periodogram, except it is transformed to have a logarithmic x-axis. This graph makes viewing the signals at lower frequencies easier. The Histogram Original plots frequency on the vertical axis and voltage on the horizontal axis to depict how often each range of voltages occurs in the signal. To download these figures, simply click the Download as PDF link at the bottom of the Inspection panel. This will generate a PDF file in a new tab with a slide for each electrode within each block. Now, use the menu at left to proceed to the wavelet module! "],["step-3-wavelet.html", "5.3 Step #3: Wavelet", " 5.3 Step #3: Wavelet Once you click the wavelet tab on the left menu, a data selection window will appear to select the project and subject whose data to apply the wavelet decomposition to. (Remember clicking the “sync from [import LFP] module” will automatically select the subject that was just imported.) Note: The notch filter must have been applied to the selected subject before trying to apply the wavelet transformation. After selecting the “Load Subject” button, a new screen will load with two panels: Wavelet Settings and Wavelet Kernel. Refer to the following screenshot for guidance. Sample Wavelet Decomposition Screen Wavelet decomposition is a type of time frequency analysis that is used for non-stationary signals (i.e. properties change over time), like that of iEEG. It separates the signal into differing frequency and phase components, which is helpful because signals in the brain are very dynamic. This process makes it so that changes in the signal’s power spectra can be visualized across both frequency and time. To learn more about how wavelet transform works, visit the Q&amp;A at Wavelet. In this module, RAVE will: - downsample the signal before running the wavelet, if desired - run a wavelet on each block in the selected subject’s folder - downsample the wavelet coefficients to 100.0 Hz to reduce the amount of space needed to save the information onto the computer’s disk Wavelet Settings: Begin by setting the basic configurations: Power sample rate refers to the rate at which the signal will be taken into time frequency decomposition. By default, it is recommended to keep this set to the default 100 Hz; this balances the data so that precision is conserved without taking up too much space on the disk. Typically, this value should only be increased if neural signals will be analyzed at very high frequencies. (Note: this is not the same as the signaling rate used in the iEEG recording set-up. For further explanation, see the Q&amp;A at Wavelet.) The Down-sample before wavelet drop down menu has the option to select a factor of 1, 2, 4, or 8 to use to reduce the sample rate. Reducing the sampling rate is done to run the wavelet transform faster and use less of the computer’s disk space. Note that selecting 1 equates to no reduction in the sampling rate. Reducing the rate by a higher factor allows for analyzing a greater frequency range. To further reduce the amount of time it takes to run the wavelet, please select the use single float precision checkbox. Note: Setting the down-sample value to 1 and leaving the box unchecked will preserve precision of the calculations and is appropriate if there are many hours available to run the wavelet. However, if quick processing of data is needed, such as in clinical situations, it is better to downsample and use single float precision. Proceed by setting the frequency and cycle configurations: The select method to generate wavelet parameters drop down menu determines how the configurations for the wavelet will be set. By default, it is set to “built in”, meaning that the frequency and cycle settings can be set manually on the RAVE interface (see bullet points below). Alternatively, selecting “upload preset” is commonly used to save time if one already has their own set configurations they want to use on the data. An upload button will appear; please upload the preset in the form of a csv with two columns for the frequency and cycles. Proceed straight to running the wavelet via the blue “run wavelet” button if a preset is uploaded. Use the frequency range slider to select the range of frequencies that will be decomposed with the wavelet. The value selected with the frequency step size slider depends on the frequency desired after the wavelet is performed. Use the wavelet cycles slider to choose the range of cycles to use in the transform. Note that a larger number of cycles will lead to more precise frequency analysis, whereas a smaller number of cycles will lead to more precise temporal analysis. Wavelet Kernel: The figures displayed on this panel visually display the properties of the wavelet given the selected configurations. The Wavelet Kernels (Real &amp; Imaginary) shows the kernel at given frequencies in Hz and times in seconds (aka wavelet length). The Wavelet Length | Frequency graph plots the length of the kernel in seconds at different frequencies in Hz. The Wavelet Cycle | Frequency graph plots the number of cycles for the wavelet at different frequencies in Hz. To download these figures, hover over the top left corner of the panel and a small, grey save icon will appear. Clicking on the icon will generate a pdf with the figures. To download the kernel parameters, click the blue download kernel parameters link at the bottom of the window. This will generate a csv file with each frequency and its corresponding number of cycles. To simply view the parameters on the interface, click anywhere on the panel and it will switch the view to display a table with the frequency and cycle data; click anywhere on this table to switch back to the figure view. (Alternatively, on figure view, click on the table icon in the top right corner of the panel.) When finished setting the configurations and reviewing the figures, select the blue Run Wavelet button. As shown below, a pop-up will appear on the screen asking to confirm the subject, frequencies, # of cycles, and precision selected for the wavelet transformation. Click “confirm” to proceed, or “confirm and run in background to continue using RAVE during the decomposition process. Note that this process can take up to 30 minutes; progress bars for each task will be displayed in the lower right corner. Sample Wavelet Decomposition Confirmation Window The process is completed if a “success” pop-up appears. This means that the signal data for the electrodes within each of the subject’s blocks have been down-sampled (if desired), decomposed by the wavelet into time-frequency data, and down-sampled again. Proceed to the next module, referencing! "],["step-4-reference-signals.html", "5.4 Step #4: Reference Signals", " 5.4 Step #4: Reference Signals Common average referencing "],["generate-epoch.html", "5.5 Generate Epoch", " 5.5 Generate Epoch "]]
